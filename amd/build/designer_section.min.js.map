{"version":3,"file":"designer_section.min.js","sources":["../src/designer_section.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Implemented designer format js.\r\n *\r\n * @module     format_designer/designer_section\r\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n define(['jquery', 'core/fragment', 'core/templates', 'core/loadingicon', 'core/ajax', 'core_course/actions'],\r\n function($, Fragment, Templates, Loadingicon, Ajax, Actions) {\r\n\r\n    var SELECTOR = {\r\n        ACTIVITYLI: 'li.activity',\r\n        SECTIONLI: 'li.section',\r\n        ACTIVITYACTION: 'a.cm-edit-action',\r\n        SECTIONACTIONMENU: '.section_action_menu.designer-menu',\r\n    };\r\n\r\n    Y.use('moodle-course-coursebase', function() {\r\n        var courseformatselector = M.course.format.get_section_selector();\r\n        if (courseformatselector) {\r\n            SELECTOR.SECTIONLI = courseformatselector;\r\n        }\r\n    });\r\n\r\n\r\n    /**\r\n     * Control designer format action\r\n     * @param {int} courseId\r\n     * @param {int} contextId\r\n     */\r\n    let DesignerSection = function(courseId, contextId) {\r\n        var self = this;\r\n        self.courseId = courseId;\r\n        self.contextId = contextId;\r\n\r\n        $('body').delegate(self.SectionController, 'click', self.sectionLayoutaction.bind(this));\r\n        $(\"body\").delegate(self.RestrictInfo, \"click\", self.moduleHandler.bind(this));\r\n        $(\"body\").delegate(self.sectionRestricted, \"click\", this.sectionRestrictHandler.bind(this));\r\n        $('body').delegate(self.fullDescription, \"click\", self.fullmodcontentHandler.bind(this));\r\n        $('body').delegate(self.trimDescription, \"click\", self.trimmodcontentHandler.bind(this));\r\n        $('body').delegate(self.goToURL, \"click\", self.redirectToModule.bind(this));\r\n        window.onhashchange = function() {\r\n            self.expandSection();\r\n        };\r\n        this.expandSection();\r\n    };\r\n\r\n    /**\r\n     * Selector section controller.\r\n     */\r\n    DesignerSection.prototype.goToURL = '.designer [data-action=\"go-to-url\"]';\r\n\r\n    DesignerSection.prototype.SectionController = \".designer #section-designer-action .dropdown-menu a\";\r\n\r\n    DesignerSection.prototype.RestrictInfo = \".designer .designer-section-content .call-action-block\";\r\n\r\n    DesignerSection.prototype.moduleBlock = \".designer .designer-section-content li.activity\";\r\n\r\n    DesignerSection.prototype.loadingElement = \".icon-loader-block\";\r\n\r\n    DesignerSection.prototype.sectionRestricted = \".designer .availability-section-block .section-restricted-action\";\r\n\r\n    DesignerSection.prototype.fullDescription = \".designer-section-content li .fullcontent-summary .mod-description-action\";\r\n\r\n    DesignerSection.prototype.trimDescription = \".designer-section-content li .trim-summary .mod-description-action\";\r\n\r\n    DesignerSection.prototype.redirectToModule = function(event) {\r\n        let nodeName = event.target.nodeName;\r\n        let preventionNodes = ['a', 'button', 'form'];\r\n        let iscircle = event.target.closest('li.activity').classList.contains('circle-layout');\r\n        let isDescription = event.target.classList.contains('mod-description-action');\r\n        let isPadlock = event.target.classList.contains('fa-lock');\r\n        if ((nodeName in preventionNodes)\r\n            || document.body.classList.contains('editing') || iscircle || isDescription || isPadlock) {\r\n            return null;\r\n        }\r\n        var card = event.target.closest(\"[data-action=go-to-url]\");\r\n        let modurl = card.getAttribute('data-url');\r\n        window.location.href = modurl;\r\n    };\r\n\r\n    DesignerSection.prototype.expandSection = () => {\r\n        // Alert();\r\n        var sectionID = window.location.hash;\r\n        if (sectionID) {\r\n            var id = sectionID.substring(1);\r\n            var section = document.getElementById(id);\r\n            if (section) {\r\n                var title = section.querySelector('.section-header-content');\r\n                if (title) {\r\n                    title.classList.remove('collapsed');\r\n                    title.setAttribute('aria-expanded', true);\r\n                }\r\n                var content = section.querySelector('.content');\r\n                if (content) {\r\n                    content.classList.add('show');\r\n                }\r\n                if (document.getElementById('section-course-accordion') !== null) {\r\n                    document.getElementById('section-head-0').classList.add('collapsed');\r\n                    document.getElementById('section-content-0').classList.remove('show');\r\n                }\r\n                section.scrollIntoView();\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n\r\n    DesignerSection.prototype.fullmodcontentHandler = function(event) {\r\n        var THIS = $(event.currentTarget);\r\n        let fullContent = $(THIS).closest('li.activity').find('.fullcontent-summary');\r\n        let trimcontent = $(THIS).closest('li.activity').find('.trim-summary');\r\n        if (trimcontent.hasClass('summary-hide')) {\r\n            trimcontent.removeClass('summary-hide');\r\n            fullContent.addClass('summary-hide');\r\n        }\r\n    };\r\n\r\n    DesignerSection.prototype.trimmodcontentHandler = function(event) {\r\n        var THIS = $(event.currentTarget);\r\n        let fullContent = $(THIS).closest('li.activity').find('.fullcontent-summary');\r\n        let trimcontent = $(THIS).closest('li.activity').find('.trim-summary');\r\n        if (fullContent.hasClass('summary-hide')) {\r\n            fullContent.removeClass('summary-hide');\r\n            trimcontent.addClass('summary-hide');\r\n        }\r\n    };\r\n\r\n    DesignerSection.prototype.sectionRestrictHandler = function(event) {\r\n        var sectionRestrictInfo = $(event.currentTarget).prev();\r\n        if (sectionRestrictInfo) {\r\n            if (!sectionRestrictInfo.hasClass('show')) {\r\n                sectionRestrictInfo.addClass('show');\r\n            } else {\r\n                sectionRestrictInfo.removeClass('show');\r\n            }\r\n        }\r\n    };\r\n\r\n    DesignerSection.prototype.moduleHandler = function(event) {\r\n        event.preventDefault();\r\n        var restrictBlock = $(event.currentTarget).parents('.restrict-block');\r\n        if (restrictBlock.length) {\r\n            if (!restrictBlock.hasClass('show')) {\r\n                restrictBlock.addClass('show');\r\n            } else {\r\n                restrictBlock.removeClass('show');\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Implementaion swith the section layout.\r\n     * @param {object} event\r\n     */\r\n    DesignerSection.prototype.sectionLayoutaction = function(event) {\r\n        var self = this;\r\n        let sectionId = event.target.closest('li.section').getAttribute('id');\r\n        var iconBlock = \"#\" + sectionId + \" \" + self.loadingElement;\r\n        var layout = $(event.currentTarget).data('value');\r\n        var layouttext = $(event.currentTarget).text();\r\n        $(event.target).parents(\".dropdown\").find(\".btn\").html(layouttext);\r\n        $(event.target).parents(\".dropdown\").find(\".btn\").val(layout);\r\n        $(event.target).parent().find(\"a.dropdown-item\").each(function() {\r\n            $(this).removeClass('active');\r\n        });\r\n        $(event.target).addClass('active');\r\n        let dataid = event.target.closest('li.section').getAttribute('data-id');\r\n        var args = {\r\n            courseid: self.courseId,\r\n            sectionid: dataid,\r\n            options: [{name: $(event.currentTarget).data('option'), value: layout}]\r\n        };\r\n        var promises = Ajax.call([{\r\n                methodname: 'format_designer_set_section_options',\r\n                args: args\r\n            }], true);\r\n            $.when.apply($, promises)\r\n            .done(function() {\r\n                const sectionpromise = Actions.refreshSection('#' + sectionId, dataid, 0);\r\n                sectionpromise.then(() => {\r\n                   return '';\r\n                }).catch();\r\n            });\r\n        Loadingicon.addIconToContainerRemoveOnCompletion(iconBlock, promises);\r\n    };\r\n\r\n    return {\r\n        init: function(courseId, contextId) {\r\n            return new DesignerSection(courseId, contextId);\r\n        }\r\n    };\r\n});"],"names":["define","$","Fragment","Templates","Loadingicon","Ajax","Actions","SELECTOR","ACTIVITYLI","SECTIONLI","ACTIVITYACTION","SECTIONACTIONMENU","Y","use","courseformatselector","M","course","format","get_section_selector","DesignerSection","courseId","contextId","self","this","delegate","SectionController","sectionLayoutaction","bind","RestrictInfo","moduleHandler","sectionRestricted","sectionRestrictHandler","fullDescription","fullmodcontentHandler","trimDescription","trimmodcontentHandler","goToURL","redirectToModule","window","onhashchange","expandSection","prototype","moduleBlock","loadingElement","event","nodeName","target","iscircle","closest","classList","contains","isDescription","isPadlock","document","body","modurl","getAttribute","location","href","sectionID","hash","id","substring","section","getElementById","title","querySelector","remove","setAttribute","content","add","scrollIntoView","THIS","currentTarget","fullContent","find","trimcontent","hasClass","removeClass","addClass","sectionRestrictInfo","prev","preventDefault","restrictBlock","parents","length","sectionId","iconBlock","layout","data","layouttext","text","html","val","parent","each","dataid","args","courseid","sectionid","options","name","value","promises","call","methodname","when","apply","done","refreshSection","then","catch","addIconToContainerRemoveOnCompletion","init"],"mappings":"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"}